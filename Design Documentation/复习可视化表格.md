# 复习可视化表格设计方案

## 需求分析

### 核心需求
- 显示需要复习的单词
- 显示多久需要复习
- 显示单词复习了几次
- 搜索功能：可以搜索特定单词
- 时间筛选：按时间进行筛选

### 扩展需求
- 复习阶段可视化
- 掌握程度展示
- 批量操作功能
- 数据统计和趋势分析

## 数据模型分析

### 现有数据字段
从 UserWordProgress 模型中：
- reviewStage: 复习阶段 (0-8)，对应艾宾浩斯遗忘曲线
- nextReviewDate: 下次复习日期
- lastReviewedAt: 最后复习时间
- createdAt: 单词首次学习时间

从 Word 表：
- wordText: 单词文本
- pronunciation: 发音

### 艾宾浩斯复习间隔
```
阶段 0 → 1：1天后
阶段 1 → 2：2天后
阶段 2 → 3：4天后
阶段 3 → 4：7天后
阶段 4 → 5：15天后
阶段 5 → 6：30天后
阶段 6 → 7：60天后
阶段 7 → 8：120天后
```

## 功能设计

### 1. 表格列设计

#### 核心列
1. **单词** - 主要内容，包含发音
2. **下次复习时间** - 关键时间信息，带颜色编码
3. **复习阶段** - 学习进度（0-8级），使用进度条可视化
4. **复习间隔** - 基于艾宾浩斯算法的时间间隔描述

#### 辅助列
5. **上次复习时间** - 学习历史记录
6. **学习天数** - 从开始学习到现在的天数
7. **掌握程度** - 根据复习阶段计算的百分比
8. **词书来源** - 来自哪个词书
9. **操作** - 立即复习、查看详情等按钮

### 2. 搜索与筛选功能

#### 搜索功能
- 模糊搜索：支持部分单词匹配
- 按状态搜索：待复习/已掌握/新词
- 按词书搜索：限定特定词书范围

#### 时间筛选
- 按下次复习时间：
  - 已过期（红色）
  - 今天到期（橙色）
  - 未来3天（黄色）
  - 未来一周（绿色）
  - 一周以后（蓝色）
- 按学习时间筛选：
  - 今天学习的
  - 本周学习的
  - 本月学习的

#### 阶段筛选
- 新词：阶段0
- 初级掌握：阶段1-3
- 中级掌握：阶段4-6
- 高级掌握：阶段7-8

### 3. 视觉设计

#### 颜色编码系统
- 红色：已过期，需要立即复习
- 橙色：今天到期，紧急
- 黄色：未来3天到期，关注
- 绿色：未来一周到期，正常
- 蓝色：一周以上到期，宽松

#### 进度可视化
- 阶段进度条：8个阶段的可视化进度
- 掌握程度：百分比显示
- 时间轴：复习历史的时间线展示

### 4. 交互功能

#### 单词操作
- 立即复习：跳转到该单词的学习页面
- 查看详情：显示单词的完整释义和例句
- 重置进度：重新学习该单词
- 标记已掌握：直接跳到最后阶段

#### 批量操作
- 批量选择：支持全选、反选
- 批量复习：选择多个单词进行批量复习
- 批量重置：重置选中单词的进度

## 技术实现方案

### 1. API 设计

#### 新端点
```
GET /api/review/visualization-table
```

#### 查询参数
- wordlistId?: number - 词书筛选
- search?: string - 搜索关键词
- timeFilter?: string - 时间筛选 (overdue|today|3days|week|future)
- stageFilter?: string - 阶段筛选 (new|beginner|intermediate|advanced)
- page?: number - 分页页码
- limit?: number - 每页数量
- sortBy?: string - 排序字段 (nextReview|reviewStage|wordText)
- sortOrder?: asc|desc - 排序方向

#### 返回数据结构
```typescript
interface ReviewVisualizationResponse {
  success: boolean;
  data: {
    words: ReviewWordItem[];
    pagination: {
      page: number;
      limit: number;
      total: number;
      totalPages: number;
    };
    statistics: {
      totalWords: number;
      overdueWords: number;
      dueTodayWords: number;
      learnedWords: number;
      masteryRate: number;
    };
  };
}
```

### 2. 组件架构

```
src/components/dashboard/review-visualization/
├── ReviewVisualizationTable.tsx      # 主组件
├── TableFilters.tsx                  # 筛选组件
├── ReviewTable.tsx                   # 表格组件
├── columns/
│   ├── WordColumn.tsx                # 单词列
│   ├── ReviewTimeColumn.tsx          # 复习时间列
│   ├── StageColumn.tsx               # 阶段列
│   └── ActionsColumn.tsx             # 操作列
├── filters/
│   ├── SearchInput.tsx               # 搜索框
│   ├── TimeFilter.tsx                # 时间筛选
│   ├── StageFilter.tsx               # 阶段筛选
│   └── WordlistFilter.tsx            # 词书筛选
├── ProgressBar.tsx                   # 进度条组件
├── UrgencyBadge.tsx                  # 紧急程度标签
└── TablePagination.tsx               # 分页组件
```

### 3. 数据处理逻辑

#### 紧急程度计算
```typescript
function calculateUrgencyLevel(nextReviewDate: Date): UrgencyLevel {
  const now = new Date();
  const diffTime = nextReviewDate.getTime() - now.getTime();
  const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

  if (diffDays < 0) return 'high';      // 已过期
  if (diffDays === 0) return 'high';    // 今天到期
  if (diffDays <= 3) return 'medium';   // 3天内
  if (diffDays <= 7) return 'low';      // 一周内
  return 'normal';                      // 一周以后
}
```

#### 掌握程度计算
```typescript
function calculateMasteryPercentage(reviewStage: number): number {
  return Math.round((reviewStage / 8) * 100);
}
```

## 实施计划

### Phase 1: 基础功能（1-2天）
1. 后端API开发
   - 创建 /api/review/visualization-table 端点
   - 实现基础查询和筛选逻辑
   - 添加分页支持

2. 类型定义
   - 扩展 learning.ts 类型定义
   - 定义表格相关接口

3. 基础组件
   - 创建主表格组件
   - 实现基础的列展示

### Phase 2: 搜索和筛选（1天）
1. 搜索功能
   - 实现搜索框组件
   - 添加模糊搜索逻辑

2. 筛选功能
   - 时间筛选组件
   - 阶段筛选组件
   - 词书筛选组件

### Phase 3: 视觉增强（1天）
1. 颜色编码
   - 实现紧急程度颜色系统
   - 添加状态标签

2. 进度可视化
   - 复习阶段进度条
   - 掌握程度百分比

### Phase 4: 交互功能（1天）
1. 操作按钮
   - 立即复习功能
   - 查看详情功能

2. 批量操作
   - 选择功能
   - 批量复习

### Phase 5: 集成和优化（1天）
1. 仪表盘集成
   - 添加到dashboard页面
   - 响应式布局优化

2. 性能优化
   - 虚拟滚动（如果需要）
   - 缓存优化

## 预期效果

### 用户体验提升
- 可视化进度：用户可以清晰看到学习进度
- 智能提醒：根据紧急程度提醒复习
- 高效管理：批量操作提高学习效率

### 数据价值
- 学习趋势：通过数据分析学习效果
- 薄弱环节：识别掌握较差的单词
- 个性化调整：根据数据调整学习策略

## 技术难点和解决方案

### 1. 性能优化
**问题**：大量单词数据可能影响渲染性能
**解决方案**：
- 实现虚拟滚动
- 分页加载
- 数据缓存

### 2. 实时更新
**问题**：学习进度需要实时更新
**解决方案**：
- 使用SWR或React Query进行数据管理
- 实现乐观更新
- 定期刷新数据

### 3. 复杂筛选逻辑
**问题**：多维度筛选的查询复杂度
**解决方案**：
- 数据库索引优化
- 筛选条件缓存
- 懒加载筛选结果

### 4. 响应式设计
**问题**：不同屏幕尺寸的适配
**解决方案**：
- Tailwind CSS响应式类
- 自适应列宽
- 移动端优化布局