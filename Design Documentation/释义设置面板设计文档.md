# 释义设置面板设计文档

## 1. 项目概述

### 1.1 功能描述
在专注学习界面添加一个释义设置面板，允许用户自定义释义显示顺序、显示状态以及界面样式，提升学习体验的个性化程度。

### 1.2 目标用户
使用专注学习功能的语言学习者，特别是对界面布局和内容展示有个性化需求的用户。

### 1.3 解决的问题
- 当前释义面板的显示顺序固定，无法根据用户偏好调整
- 界面元素大小固定，无法适应不同用户的视觉需求
- 缺乏个性化设置，影响用户体验

## 2. 功能需求

### 2.1 释义类型管理
- **释义类型**：基本释义、权威释义、英汉释义、英英释义、网络释义
- **显示顺序调整**：通过拖拽调整释义类型的显示顺序
- **显示开关**：通过切换开关控制每个释义类型的显示/隐藏
- **实时预览**：设置变更立即应用到当前释义面板

### 2.2 界面样式调整
- **字体大小调整**：12px-24px范围，使用滑块控制
- **释义面板宽度**：400px-800px范围，使用滑块控制
- **单词卡片大小**：100px-200px范围，使用滑块控制
- **实时预览**：调整时立即看到效果

### 2.3 设置持久化
- **本地存储**：使用localStorage保存用户设置
- **自动恢复**：页面加载时自动恢复用户的个性化设置
- **重置功能**：提供"重置为默认"按钮，恢复初始设置

## 3. 技术设计

### 3.1 数据结构设计

```typescript
// 释义类型设置
interface DefinitionTypeSetting {
  id: string; // 'basic', 'authoritative', 'bilingual', 'english', 'web'
  name: string; // 显示名称：基本释义、权威释义等
  enabled: boolean; // 是否显示
  order: number; // 显示顺序
}

// 界面设置
interface UISettings {
  fontSize: number; // 字体大小 (12-24px)
  panelWidth: number; // 释义面板宽度 (400-800px)
  cardSize: number; // 单词卡片大小 (100-200px)
}

// 完整设置
interface DefinitionSettings {
  definitionTypes: DefinitionTypeSetting[];
  uiSettings: UISettings;
}
```

### 3.2 默认配置

```typescript
const defaultSettings: DefinitionSettings = {
  definitionTypes: [
    { id: 'authoritative', name: '权威释义', enabled: true, order: 1 },
    { id: 'bilingual', name: '英汉释义', enabled: true, order: 2 },
    { id: 'english', name: '英英释义', enabled: true, order: 3 },
    { id: 'basic', name: '基本释义', enabled: true, order: 4 },
    { id: 'web', name: '网络释义', enabled: true, order: 5 }
  ],
  uiSettings: {
    fontSize: 16, // 默认16px
    panelWidth: 600, // 默认600px
    cardSize: 140 // 默认140px
  }
};
```

### 3.3 组件架构

```
FocusLearningPage
├── DefinitionSettingsButton (新增)
├── DefinitionSettingsModal (新增)
│   ├── DefinitionTypeList (可拖拽列表)
│   │   └── DefinitionTypeItem (可拖拽项)
│   ├── UIControls (滑块控制)
│   │   ├── FontSizeSlider
│   │   ├── PanelWidthSlider
│   │   └── CardSizeSlider
│   └── ActionButtons (操作按钮)
│       ├── ResetButton
│       └── CloseButton
├── DefinitionPanel (修改)
└── WordCard (修改)
```

## 4. UI/UX设计

### 4.1 设置面板布局
- **面板类型**：模态弹窗，位于释义面板上方
- **背景遮罩**：半透明黑色背景，点击可关闭面板
- **面板尺寸**：宽度500px，高度自适应，最大高度80vh
- **位置**：屏幕中央，垂直水平居中

### 4.2 释义类型列表
- **列表项设计**：每个释义类型为一个可拖拽项
- **拖拽指示器**：左侧显示拖拽图标（三条横线）
- **切换开关**：右侧显示Toggle Switch
- **拖拽反馈**：拖拽时显示阴影效果和放置位置指示器

### 4.3 滑块控件
- **字体大小滑块**：12px-24px，默认16px
- **面板宽度滑块**：400px-800px，默认600px
- **卡片大小滑块**：100px-200px，默认140px
- **数值显示**：滑块右侧显示当前数值

### 4.4 操作按钮
- **重置按钮**：左侧，文字"重置为默认"
- **关闭按钮**：右侧，文字"关闭"或使用X图标

## 5. 交互设计

### 5.1 拖拽交互
1. 用户按住释义类型项开始拖拽
2. 显示拖拽项的半透明副本跟随鼠标
3. 其他项显示放置位置指示器
4. 释放鼠标时完成位置交换
5. 更新设置并立即应用

### 5.2 开关交互
1. 用户点击Toggle Switch
2. 开关状态切换动画
3. 更新设置并立即应用
4. 对应释义类型显示/隐藏

### 5.3 滑块交互
1. 用户拖动滑块
2. 实时显示数值变化
3. 释放鼠标时更新设置
4. 立即应用样式变化

### 5.4 面板关闭
- **关闭方式**：点击关闭按钮、点击外部区域、按ESC键
- **关闭动画**：淡出效果
- **状态保存**：关闭前保存所有设置

## 6. 技术实现

### 6.1 拖拽实现
使用HTML5 Drag and Drop API：
- `draggable`属性设置可拖拽项
- `onDragStart`、`onDragOver`、`onDrop`事件处理
- 数据传输使用`dataTransfer`对象

### 6.2 状态管理
使用React useState和useEffect：
- 本地状态管理设置数据
- useEffect监听设置变化并应用
- 使用Context或props传递设置

### 6.3 本地存储
使用localStorage：
- 设置变更时自动保存
- 页面加载时读取并恢复设置
- 错误处理和默认值回退

### 6.4 实时预览
设置变更时通过以下方式实现实时预览：
- 更新释义面板的排序逻辑
- 动态修改CSS样式
- 触发组件重新渲染

## 7. 文件结构

```
src/
├── components/
│   ├── learning/
│   │   ├── DefinitionSettingsButton.tsx (新增)
│   │   ├── DefinitionSettingsModal.tsx (新增)
│   │   ├── DefinitionTypeList.tsx (新增)
│   │   ├── DefinitionTypeItem.tsx (新增)
│   │   ├── UIControls.tsx (新增)
│   │   └── ToggleSwitch.tsx (新增)
├── hooks/
│   └── useDefinitionSettings.ts (新增)
├── lib/
│   └── definitionSettings.ts (新增)
└── types/
    └── definitionSettings.ts (新增)
```

## 8. 开发计划

### 8.1 第一阶段：基础结构
1. 创建数据类型定义
2. 实现设置状态管理
3. 创建基础组件结构
4. 实现本地存储功能

### 8.2 第二阶段：释义类型管理
1. 实现释义类型列表组件
2. 添加拖拽功能
3. 实现Toggle Switch组件
4. 集成释义显示逻辑

### 8.3 第三阶段：界面样式调整
1. 创建滑块控件组件
2. 实现字体大小调整
3. 实现面板宽度调整
4. 实现卡片大小调整

### 8.4 第四阶段：集成与测试
1. 集成到专注学习页面
2. 实现实时预览功能
3. 添加重置功能
4. 全面测试和优化

## 9. 测试计划

### 9.1 功能测试
- 拖拽调整释义顺序
- 开关释义类型显示
- 调整界面样式参数
- 设置持久化和恢复
- 重置为默认设置

### 9.2 兼容性测试
- 不同浏览器兼容性
- 不同屏幕尺寸适配
- 触摸设备支持

### 9.3 性能测试
- 大量释义数据时的性能
- 拖拽操作流畅度
- 设置变更响应速度

## 10. 风险评估

### 10.1 技术风险
- **拖拽兼容性**：HTML5拖拽API在不同浏览器中表现可能不一致
- **状态同步**：设置变更与界面更新的同步复杂性
- **本地存储限制**：localStorage容量和访问限制

### 10.2 用户体验风险
- **学习成本**：新功能可能增加用户学习成本
- **复杂性**：过多选项可能让界面显得复杂
- **性能影响**：实时预览可能影响页面性能

### 10.3 缓解措施
- 提供直观的视觉反馈和操作提示
- 合理的默认设置，减少用户配置需求
- 优化渲染逻辑，减少不必要的重绘